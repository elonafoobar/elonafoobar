# 更新履歴

## [0.7.3] - 2020-06-21

### 修正

* [本家] 「達成のシーンをもう一度再現する？」というメッセージが表示される位置を修正
* [本家] アリーナやペットアリーナで敵を倒さずに勝利することがあるのを修正
  * アリーナにおいて、5% ほどの確率でモンスターを倒していないのに勝利することがある。これはペットアリーナでも起こる
* [本家] 神託が予期しないアイテムを記録していることがあるのを修正
  * カードや剥製を願ったとき、そのキャラクタが持っている固定AFが神託に記録されていた。例えば、マニのカードを願うと猫の尻尾が信託に載っていた
* 模様替えモードでのチラつきを修正
* `core.auto_target` オプションがオンのときの、プレイヤーのターゲット処理を修正
* ゴーレムが朦朧になっていたのを修正
* 内部システムに関する潜在的なクラッシュを含む問題を修正
* プレイヤーの魔法や杖によるダメージに関わる処理を修正
* 盗賊団の頭領、豹頭の戦士、シルヴィアが落とすアイテムの数を修正
* タイポ修正


### 追加

* `i` 干渉 メニューに「吊る」選択肢を追加。任意の NPC を吊ることができる。Wizard モードでのみ利用可能
* キャラチップの描写処理速度を改善
* 荷車の荷物をショートカット登録できるように
  * ネフィアなどではこれまでどおり荷車の荷物を利用することはできません
* セーブ選択画面に情報を追加
  * 古いセーブデータをこのバージョン以降でセーブすると、新しいファイル `header.json` が作られる。セーブデータがこのファイルを持っている場合、その情報がセーブ選択画面に表示される
* キャラクタの影の描写を改善
* [MOD] `init.lua` を持たない MOD を許容するように


### 変更

* 「盗む」のインベントリ画面を少しだけ変更
  * 地面のアイテムを盗むとき、本家や古い foobar ではプレイヤーの所持金が画面に表示される。これは無意味な情報であり、このバージョン以降では表示されないようになる
* セーブフォルダの名前の付け方を変更
  * 古いセーブデータの名前は変更されません。また、変更する必要もありません。
  * 副作用として、プレイヤー名の被りを気にせずに好きな名前をつけられるようになった
* `.map` ファイルの未使用部分を削除。ファイルサイズが平均して 90% 削減された
* マップアイテムの内部表現を変更。これにより、一つのタイルにスタックさせられるアイテムの数が 3 から 4 に増えた。また、袋アイコンは「5種類以上のアイテムがスタックしている」ことを意味するようになり、袋2つだと10種類以上、袋3つだと15種類以上、袋4つだと20種類以上スタックしていることを意味するようになった
* 不要なセーブファイル (`mod_inv*` および `mod_cdata*`) を削除
* [MOD] Data に紐づけられている翻訳テキストの定義を簡略化
* [MOD] 調合レシピの定義を Lua 側に移動
* [MOD] 神の捧げ物の定義を Lua 側に移動


### 削除

* 「コンソールを切り替え」アクションを削除。このアクションはゲーム内コンソールウィンドウを表示/非表示にする



## [0.7.2] - 2020-05-27

### 修正

* 内部的なアイテム管理システムに関わるクラッシュを修正
  * これは応急処置です。クラッシュを防ぐ代わりに一部のゲームメッセージ内のアイテム名が「何か」で置き換わります。このバグが完全に修正されるのは次のバージョンになります
* 一度解錠に失敗し二度目の挑戦で成功したとき、箱や宝箱が開かない問題を修正
* 何度も解錠に挑戦すると落ちるのを修正



## [0.7.1] - 2020-04-12

### 修正

* 訪問してきた冒険者が、生命力が得意なスキルだと言うのを修正
* 錬金などのテキストにおけるエラーを修正
* autopick で食べ物が拾えなかったのを修正
* 錬金に成功していてもアイテムを失うことがあったのを修正
* ログ画面のテキストが薄くなっていたのを修正
* 一部のUIでテキストが途中で切れていたのを修正
* 左上のデジタル時計の表示を改善
* タイポ修正


### 追加

* SEとBGMの音量を調節するオプションを追加 (0-8まで)。デフォルトは 8 (最大音量)
* コンソールコマンドを追加
  * `:wish`
  * `:gain_spell`
  * `:gain_exp`
  * `:gain_fame`


### 変更

* コンソール機能を刷新



## [0.7.0] - 2020-03-22

MODシステムが大幅に変更されました。


### 修正

- いくつかのSEが再生されなかったのを修正
- 一部のモンスターからのドロップアイテムを修正
  - ヴェスダが籠手を落とさなかった
  - 大富豪、貴族の子供、観光客が財布を落とさなかった。また、本家よりも多くの鉱石を落としていた
- v0.6.1で一時的に無効化していたネットワーク機能を再度有効化
- メインシナリオのテキストにおける些細なミスを修正
- ランダムアイテム名とアイテムの色が一致していなかったのを修正


### 追加

- アプリケーションアイコン (atcat) を追加。今のところWindowsのみ
- 模様替えモードで部分的に元に戻す/やり直しをサポート
  - これは実験的機能であり、キーバインディングなどは将来のバージョンで変更されるかもしれません
- [MOD] MODで使用可能なグローバル関数、ライブラリを追加


### 変更

- [MOD] 翻訳リソースの文法を変更
- [MOD] Luaのenumの命名規則を変更
- [MOD] `require_relative()`を`require()`にリネーム
- [MOD] `require()` (旧名`require_relative()`) のパス探索ルールを変更。v0.6.1ではこの関数はMODのルートディレクトリからの相対パスを受け取っていたが、このリリース以降は呼び出した関数が定義されているファイルからの相対パスを受け取るようになる
  - 以前の動作を望む場合、`/`で始まるパスを渡す
  - さらに、関数が`.lua`を補わないようになった。明示的に拡張子を指定する必要がある
- [MOD] 翻訳読み込みのエントリーポイントとして各localeフォルダ中`i18n.lua`を追加。`locale/<現在のlocale>/`以下のファイルは自動的に読み込まれない
- [MOD] `require()`を`ELONA.require()`に変更
- [MOD] `game`モジュールを`core` MODに移動.
  - したがって、`require("game.Chara")`の代わりに`ELONA.require("core.Chara")`と呼ぶ必要がある.
- [MOD] `data`のインターフェースを変更.
  - `data:define_type()`を`data:define_prototype()`にリネーム
  - `data:add()`と`data:add_mult()`を統合
  - `data:add()`の引数を変更。`id`プロパティを持つテーブルの配列を渡す代わりに、IDがキーのテーブルを渡す
- [MOD] Data Systemと同じようにAPIを定義するための"api"を導入



## [0.6.1] - 2020-02-11

Windows のみのリリース


### 修正

- クラッシュを避けるため一時的に Windows でのネットワーク機能を無効化



## [0.6.0] - 2019-02-01

### 追加

- 「拡張設定(foobar)」にデジタル時計にするオプションを追加
  - 「する」に設定すると、左上の時計が24時間のデジタル表示になる
  - 規定値: 「しない」
- 「拡張設定(foobar)」にオートターゲットオプションを追加
  - 「する」に設定すると、仲間 (あなたを除く) が自動的にあなたから見えている敵を攻撃するようになる
  - 規定値: 「しない」
- [MOD] MODリスト機能を実装。MODを有効、無効にできる
  - 新しいファイル `profile/<current profile>/mods.json` を追加。有効にしたいMODを列挙する
  - MODのフォルダ名にバージョンを付与。例: `core-0.2.6`
  - ファイルを直接編集するか、「MOD一覧」メニューからGUIで切り替えるかすることができる
- MODをテンプレートから作った際、メッセージプロンプトを表示するように
- [MOD] `Rand.rnd_capped(n)` を追加。`Rand.rnd(n)` と似ているが、`[0, n')`内の整数を返す (ただし `n'` は `min(n, 32768)`)
- [MOD] `JSON5` モジュールを追加。`JSON5.parse()` と `JSON5.stringify()` の2関数がある


### 変更

- HCLファイルの一部をLuaとJSON5に移行
  - `keybindings.hcl` -> `keybindings.json`
  - `config.hcl` -> `config.json`
  - [MOD] 各MODの `config_def.hcl` -> `config-schema.lua`
  - [MOD] 各MODの `mod.hcl` -> `mod.json`
- いくつかの乱数の範囲を本家の挙動を再現するために制限。例えば、ランダムイベントで得る/失う金額は本家と同様キャップがかかるようになる
- 開発者向け文書を改善
- プレイヤーの視界の影の描写を改善
- bone ファイルの bone 数上限を撤廃 (以前は 80)
  - 以前の bone ファイル (`bone.txt`) と現在のものとは互換性がありません
- 「コンソールを切り替える」・「コンソールを開く」のデフォルトキーバインディングを変更
  - コンソールを切り替える: `F12`
  - コンソールを開く: `Shift+F12`
  - 以前は `F12` に「ヴォルデモートモードを有効にする」がバインドされていました。このバージョンではそれに対するショートカットはありませんが、`voldemort` コマンドをコンソールで実行することでモードを有効にできます
- マグルモード (= 非ウィザードモード) でコンソールが開けるように
- クエスト関連のデータをクエスト依頼品のアイテムにセットしないように
  - この変更により、街の NPC が持つクエストアイテムが他のアイテムとスタックする
- [MOD] `Config.get_{type}` と `Config.set_{type}` を統合
  - `Config.get_int()`、`Config.get_bool()`、`Config.get_string()` の代わりに `Config.get()` を使ってください
  - `Config.set_int()`、`Config.set_bool()`、`Config.set_string()` の代わりに `Config.set()` を使ってください
- ゲーム開始時に表示されるメッセージを変更
  - 元のメッセージ: "Lafrontier presents Elona ver 1.22. Welcome traveler!"
  - このヴァリアントは「Elona ver 1.22」でもなければ「Lafrontier」によって開発されているわけでもないため、メッセージを「Welcome traveler!」に変更


### 削除

- 古いセーブデータのサポートを廃止 (foobar v0.4.x 以前)
  - これらのデータを持っている場合は、v0.5.0 でアップデートした後 v0.6.0 に更新してください
- Android OS のサポートを削除。理由は以下の通り:
  - モバイルフレンドリーとはかけ離れた UI
  - モバイルの画面に対して小さすぎる文字と多すぎる情報量
  - MOD機能による実行速度低下
  - 以上の問題をすべて解決するにはコストがかかりすぎる
  - Elona foobar は OSS であるため、Android バージョンが必要な場合はライセンスに従う限りフォーク可能です



### 修正

- [本家] いくつかのゲームイベントが「時間の逆転」を引き起こしうるのを修正
  - エヘカトルの中の神、結婚、ペットとの再会などのイベントは、本家では少々変わった方法で処理されていた。最も最近発生したイベントが最初に処理されていましたが、これは最後になるべきであった
- [本家] 「二重マップ退出バグ」を修正
  - バグ: 依頼マップにおいて、ちょうど時間切れになるターンにマップから出ると、ワールドマップに出る
- [本家] プレイヤーの視界の影の描写を修正。影のいくつかが繋がっていなかった
- ネットワーク接続のエラー処理を改善
- ツェンが何も落とさないのを修正
- Windows における DLL エラーに起因するクラッシュを修正
- キャラメイクの種族選択メニューで落ちるのを修正
- 魔術師の収穫が誤って弱体化されていたのを修正
- マップ生成のアルゴリズムを修正 (以前のバージョンでは、本家と若干部屋の形が変わっていたかもしれない)
- 妹猫/妹/メイドが他のキャラクタのセリフを話すのを修正
- 討伐依頼を受けたときにごくまれに落ちるのを修正
- 走れなくなっていたのを修正/素早く攻撃することができなくなっていたのを修正
- 水の波紋が非常に短いフレームで消えていたのを修正
- テンプレートから作成した MOD のマニフェストファイルを修正
  - テンプレートから作成した MOD のマニフェストファイルは、テンプレート MOD の単なるコピーだった。現在はコピー後に入力した名前になるよう変更される
- macOS における dylib エラーに起因するクラッシュを修正
- `*` (アスタリスク) キー (テンキーにある方ではない) が JIS 配列のキーボードでバインドできなかったのを修正
- タイポ修正



## [0.5.0] - 2019-08-12

### 追加

- MOD詳細画面で`README.md`の他に`README.markdown`、`README.txt`、`README`をサポートするように
- メインタイトル画面に「MOD」メニューを追加
- Experimental: MODテンプレート機能を実装。「MOD」→「開発」メニューから試すことができる
- キーリピートを制御するための新しいオプションを追加
  - `initial_key_repeat_wait`: 最初の行動から二番目の行動までの待ちフレーム数
  - `key_repeat_wait`: 各行動間での待ちフレーム数
- 見た目変更画面における処理速度を改善。PCC画像を何か変更したときだけ読み込むように
- 見た目変更画面を改善。四方向を同時に表示するように
- MOD設定画面でMODを名前で並び替えるように
- MODが一つしか設定セクションを持たない場合展開するように
- 本家のチャット/投票機能を実装
  - 送受信するものを決めるための関連するオプションを追加
- Experimental: パルミア・タイムズを実装。より細かいゲームプレイログ
- Experimental: マウスを部分的にサポート
- 英語におけるアイテム名の複数形のルールを改善
- foobarが内部で新しいファイルやフォルダを生成する際、システムによって予約されているパスをチェックするように
- Experimental: スクリーンショット機能を実装。`Print Screen`キー (キーは変更可能) からスクリーンショットを撮ることができる。スクリーンショットは`profile/[current profile]/screenshot`フォルダに保存される.
  - 今のところ、スクリーンショットはプレイヤーキャラクターが行動可能なときにしか撮ることができない
- [MOD] Lua APIを追加: `Wish`モジュール。カスタム願いを追加できる
- [MOD] Lua APIを追加: `Data`モジュール。`data.lua`で定義された任意のデータを取得できる
- [MOD] `data-update.lua`をサポート。既存のデータをMODから変更する
- [MOD] storeオブジェクトの「揮発性」データは保存しないように。storeオブジェクトの`\_`から始まるトップレベルのフィールドは「揮発性」とみなされ保存の際スキップされる
- [MOD] パス文字列中の`<LANGUAGE>`を現在の言語に展開するように
- [MOD] 整数値オプションに`step`プロパティを追加。このプロパティを持つオプションは`step`分増加/減少する


### 変更

- 乱数生成方法をmt19937からxorshfitの亜種であるxoshiro256に変更
- 乱数生成がある程度決定的になるように
- [MOD] データIDをいくつか変更
- [MOD] ロケールのリソースIDから`locale`を削除
- [MOD] エクスポート関数のIDから`exports:`を削除
- [MOD] 他のMODのディレクトリを参照する表記法を変更。`__mod_name_here__` to `<mod_name_here>`
  - [MOD] さらに実行パスを参照するための特殊な擬似MODの名前を`BUILTIN`から`_builtin_`に変更
- [MOD] `Store`オブジェクトを`mod.store`に
- [MOD] モジュールをエクスポートする方法を変更。`mod/core/init.lua`を参照のこと
- [MOD] `Elona.require()`を`require()`に、`require()`を`require_relative()`に変更。詳細は`core`MODを参照のこと


### 削除

- 未使用のセーブファイル`gdatan.s1`を削除
- いくつかのfoobarの機能をロールバック
  - 謎のお魚を削除。これらはクジラで置き換えられる
  - カード収集機能を削除
  - 新しく追加されたオプションのいくつかを規定ではオフに。手動で再度有効にすることが可能
    - `hp_bar_position`: right -> hide
    - `allow_enhanced_skill_tracking`: on -> off
    - `leash_icon`: on -> off
    - `autopick`: on -> off
    - `damage_popup`: on -> off
    - `restore_interval`: 3 -> 7


### 修正

- [本家] おみやげを渡したときの不自然な挙動を修正
  - NPCまたはペットに渡したとき、PCの重荷状態が更新されない
  - NPCに渡したとき、他のアイテムと異なりターンが経過しない
  - ペットに渡したとき、他のアイテムを連続して渡せない
  - ペットに渡したあと、直前のインベントリメニューを開く`x`を押すとそのペットに渡すメニューが表示される
- [本家] グローバルマップで表示される「がある。」というメッセージを修正
- [本家] ESCを押しても詳細メニューから見た目変更メニューに戻れないのを修正
- [本家] シンプルな棚のアイテムチップのスタックする高さとY方向のオフセットを修正
- [本家] ある隠し要素が動いていなかったのを修正
- [本家] モイアーが死んでいてもセリフを話すのを修正
- 原子爆弾のダメージポップアップの色を修正
- 見た目変更メニューをEnterで閉じられないのを修正
- フィートメニューのキーヒントがキーバインディング設定を反映していないのを修正
- F11を押すとクラッシュするのを修正
- PCの誕生年を修正。v0.4.3で新しく生成されたキャラクターが実際よりも年をとっていた
- タイトル画面で利用できないアイテムメニューを選ぶと落ちるのを修正
- いくつかのメッセージが表示されていなかったのを修正
- ツェンが何も落とさなかったのを修正
- タイポ修正



## [0.4.3] - 2019-05-31

### 追加

- NPCが潜在能力のポーションを飲んだとき自動保存しないように
- 職業デバッガーに鍵開けスキルを追加


### 修正

- [本家] スタックした井戸が同時に干上がっていたのを修正
- 周りで植物が育っているとマテリアルスポットの採取に失敗していたのを修正
- 子犬の洞窟4階でポピーが出現しなかったのを修正
- Windowsでfoobarの起動に失敗するのを修正
- `core.all_mods_loaded`イベントが発生しなかったのを修正
- ノースティリスの(27, 47)にあるおかしなランダムネフィアを修正
  - タイルセットが誤っており、最下層が1階、その上地殻変動の後でも消えなかった
  - このネフィアは古いセーブデータをアップデートする際に削除されます。注意: foobarをアップロードする前にこのネフィアを出てください
- テキストの誤りをいくつか修正



## [0.4.2] - 2019-05-24

### 追加

- ゲーム内コンソールの出力を人が見やすいように改善
- タイトル画面での水の波紋エフェクトを実装。また、これまで効果のなかったtitle_effectオプションも利用可能にした


### 修正

- [本家] ストーリーの開始時刻を01:10から16:10に変更
  - 詳細はこれらのツイートを参照のこと: https://twitter.com/ki_foobar/status/1105046955556724736?s=19
- 天候エフェクトの不具合を修正
- カジノのカードの描写不具合を修正
- v0.3.3からアップデートしたセーブにおけるスターシャのポートレイトを修正
- ShiftまたはESCで会話ウィンドウをキャンセルしたときに起こるエラーを修正
- モンスターボールを投げたとき、モンスターボールの幽霊(見えるが拾えない)が現れるのを修正
- v0.4.0からセーブデータを更新するのに失敗するのを修正。このバグはセーブを完全に壊しうる。
- アイテムkiroku.counterを金貨で置き換え。kiroku.counterはサンプルMODのkiroku MODに含まれていたMOD追加アイテム。kiroku MODがv0.4.0で削除されたことで、未定義アイテムエラーを引き起こしていた
- 雪タイル上から野外マップに入っても雪原マップが生成されないのを修正



## [0.4.1] - 2019-05-19

### 修正

- 古いセーブデータ(`shop*.s2`)を更新した。これにより容れ物を開けたときにしばしばElonaが落ちていた
- 実装されていたが表示されていなかったローディングスクリーンを表示するように
  - あなたは復活の呪文を唱えた。プチは復活した！



## [0.4.0] - 2019-05-18

### 追加

- 環境についての情報を取得するLuaのモジュール `Env`を追加
- ローディングスクリーンを追加。(プチはころころと転がっている)
- プレイヤー用のREADMEである`README-ja.txt`と`README-en.txt`を追加
- プロファイルシステムの実装
  - `profile`フォルダを追加
  - プロファイルごとにセーブデータを分けられるようセーブフォルダを`profile/<プロファイル名>/save`に移動
  - プロファイルごとに設定を分けられるよう設定ファイルを`profile/<プロファイル名>/config.hcl`に移動
- MODが画像や音声ファイルの場所を変えられるようにするためのアセットシステムを実装
- MODがMOD自身の設定を作れるように
- Luaスクリプトを基にした会話システムを実装。すでにほとんどすべてのユニークの会話は新しいシステムで置き換えられている
- バージョンベースのMODの依存関係を導入
- MOD用にLuaの`coroutine`モジュールを追加
- ゲーム内キーマクロ機能の実装および関連APIの追加
- 本家のようなコンソールの実装。利用可能なコマンドは`help`コマンドまたはその別名の`?`を実行のこと
- Luaでのマップ生成を実装。現在子犬の洞窟はLuaにより生成されている
- MODの情報をセーブデータに保存するように。いくつかの新しいセーブファイルが導入される
  - `mod.s1`: グローバル
  - `mod_cdata.s1`: グローバル、キャラクターの参照
  - `mod_inv.s1`: グローバル、アイテムの参照
  - `mod_map_<xxx>.s2`: マップローカル
  - `map_cdata_<xxx>.s2`: マップローカル、キャラクターの参照
  - `map_inv_<xxx>.s2`: マップローカル、アイテムの参照
-  「〜を維持する」と「〜を無効にする」のエンチャントをアイテムリストメニューに表示するように
  - 耐性の可視/不可視を切り替えるのと同様にして、`z`キーを押すことでモードを切り替えられる
  - なし → 耐性 → 維持と無効 → なし → ……
- MODの一覧メニューをメインタイトルメニューに追加。今のところインストール済みのMODが見られるのみ
- 影付き文字の描写速度を改善


### 変更

- 家宝ランキングの表示される順番を入れ替え。1位が最初に、10位が最後に来る
- メインメニューの「ホームページを開く」を「About」に変更。このメニューは以下のサブメニューを含む
  - 本家ホームページ
  - Elona foobar ホームページ
  - Elona foobar 更新履歴
  - ライセンス
  - クレジット
- `music`オプションを文字列から真偽値に変更。`mci`と`direct_music`の間に特に違いがないため
- ログの形式を変更: `経過時間 深刻度 [タグ] メッセージ`
- `log.txt`を削除し、`log`フォルダを追加。このフォルダは最大で10個直近のログファイルを保持する。`0.log`が最新で`9.log`が最古
- マップタイルのデータをLuaに移動
- 将来の拡張に備え、Luaスクリプト中のイベントのコールバックが引数ではなく単一のテーブルを受け取るように


### 削除

- ゲーム中で使われていないマップファイルを削除
- いくつかの設定を削除。これらはまったくあるいはほぼ効果がないか、めったに使われない
  - `ui.msg_line`
  - `ui.tile_size`
  - `ui.font_size`
  - `ui.inv_ver_type`
  - `ui.window_x`
  - `ui.window_y`
  - `ui.clock_x`
  - `ui.clock_w`
  - `ui.clock_h`
- `data/script`フォルダ以下にあった使われていないLuaスクリプトを削除
- `musiclist.txt`のサポートを削除。この機能はMODによっていずれ置き換えられる
- `original`フォルダを削除。本家から`original`フォルダをコピーしてくる必要がなくなった


### 修正

- [本家] スクロール=する / 走り時スクロール=する / 走りの速さ=3 のとき、走れなくなるのを修正
- [本家] `{sex}`タグがPCの性別に関わらず常に「男」で置き換わっていたのを修正
- [本家] プロポーショナルフォントを使っていてもアイテムリストメニューの耐性表示が縦に揃うように
- [本家] 模様替えの際にカーソルを左上のタイルに動かすとちらつくのを修正
- [本家] アイテムの不自然なサブカテゴリを修正
  - 苺: その他 → 果物
  - 英雄チーズ: 果物 → その他
  - うさぎのしっぽ: 果物 → その他
- omakeから輸入機能である模様替え時の`Ctrl` + 左Clickがログのキー説明に表示されていなかったのを修正
- `x`キーと`X`キーの規定のキーバインディングを修正。今は本家と同様に、`x`は最後に使ったインベントリメニューを開き、`X`は常に「調べる」メニューを開くようになった
- 選択した\*勝利\*コメントが\*勝利\*ウィンドウに表示されていなかったのを修正
- 本家Elonaのホームページへのリンクが壊れていたのを修正。http://ylvania.orgに更新した
- WindowsにおいてGitのコミットハッシュがログに出力されていなかったのを修正
- 現在の大陸にランダムネフィアがある状態で帰還すると落ちていたのを修正
- ゲーム内コンソールでElona foobarのAPIが使えなくなっていたのを修正
- クイックメニューが輝いていなかったのを修正
- クロスボウのアニメーションの間違いを修正。以前は誤って銃弾の画像が用いられていたが、今は矢のアニメーションが再生される
- TCGにおけるメッセージのテキスト色を修正
- ゲームヘルプのテキストが滲んでいたのを修正
- 次のバグを修正した: 護衛依頼の最中に帰還しようとしたとき、「それは禁止されている。本当に帰還する？」と確認のダイアログが出る。Yesと答えたときに帰還するようにせねばならないところを、Yesと答えると帰還をキャンセルし、Noと答えると帰還するようになっていた
- フィートメニューで`x`キーが効かなかったのを修正
- インベントリメニューと装備メニューで耐性の可視/不可視の状態が共有されていなかったのを修正
- ファイルパスがマルチバイト文字を含んでいた場合にエラーメッセージが文字化けするのを修正
- プロンプトがキーリピートの状態をクリアしないのを修正
- タイポ修正



## [0.3.3] - 2019-01-12

### 修正

- キャラクターシートに表示されるスキルや耐性のボーナス値表示が実際と異なるのを修正
- 調合において入力した値にかかわらず一度に一つしか作れなかったのを修正
- 一部のテキストの色を修正
- 仲間が加入したとき特定の条件下で落ちるのを修正



## [0.3.2] - 2019-01-06

### 追加

- Autopick機能を強化。これらの新機能は概ねomake互換
  - カテゴリーベースのアイテム選択をサポート
  - アイテムの修飾語をサポート


### 変更

- 「決定」アクションと「自動行動」アクションを統合
- Autopickにおいて、ファイル名の代わりにサウンドIDを使うように
  - 例) 旧: `atk_chaos.wav`  新: `core.atk_chaos`
  - このバージョンではこれらのIDは`mods\core\data\sound.lua`で定義されている


### 修正

- [本家] 3つの関所マップが屋内扱いだったのを修正
- 一つ前のアイテム描写データがノイエル聖夜祭の前後で残るのを修正
- 上り階段と下り階段の位置が逆になって保存されていたのを修正
- 調達依頼でアイテムを交換した後、異なるアイテムの名前が表示されるのを修正
- 北東/北西キーによる+100/-100単位での数値入力が動いていなかったのを修正
- 欠損していたプレイヤー所有物件のデータを追加。帰還のときにクラッシュを引き起こしていた
- 斜め移動が誤ったキーに割り当てられていたのを修正
- 本家のとあるイースターエッグコマンドが一つ前のバージョンで使えなくなっていたのを修正
- キャラシートでポートレイトメニューを開くキーである`p`が16番目のメニュー選択キーと干渉していたのを修正。一つ前のバージョンでは選択キーとしての`p`が使えなくなっていた
- ログウィンドウでの1ページスクロールにおいて、一番上/下の行が飛ばされるのを修正
- デバフ(hex)を除こうとすると落ちるのを修正。例) 清浄なる光の魔法、全浄化の巻物など
- タイポ修正



## [0.3.1] - 2018-12-17

### 修正

- 起動時に落ちるのを修正
- Elona foobar を日本語が入ったフォルダに入れていた場合落ちるのを修正



## [0.3.0] - 2018-12-15

### 追加

- 新しいショートカットキー `Ctrl+Tab` を追加。一つ前の(左の)メニューへ移動する
- `Shift+Backspace` でオートピックの定義ファイルを再読み込みできるように
- 大事な仲間が遺伝子合成で失われないように。聴診器を使うことで大事な仲間に指定できる
- キーバインディングを実装。設定画面の一番下にあるキーバインディング画面から設定できる
- 現在のFPS(frame per second)を表示するオプションを追加(デフォルト: オフ)
- Luaを使ってコンソールを再実装。Luaのコードをコンソール上で走らせることができる
- キャラクタのドロップアイテムデータを外部化
- ブラックジャックの描画を改善
  - キャラクタ画像を原寸大で表示するように
  - カードのスートを表示するように
  - カードのランクを画像として表示するように
- E+Cからメインシナリオの英語翻訳を移植
- ほとんどのマップ定義データを外部化
- 店で売られている商品のデータを外部化
- 店で売買する際の確認プロンプトを省略できるオプションを追加(デフォルト: オフ)
- メッセージログをスクロールできるように(1000行分保持する)。利用可能なショートカットは以下の通り:
  - `Up`: 一行上へスクロール (古い方へ)
  - `Down`: 一行下へスクロール (新しい方へ)
  - `Left`: 一ページ上へスクロール (古い方へ)
  - `Right`: 一ページ下へスクロール (新しい方へ)
- 英語モードにおけるルードルボの名前を変更("yeek" → "\<Rodlob\> the boss of yeeks")
  - この名前は、日本語でそうであるように Angband のモンスターである "Boldor" のスペルを反転させたもの
- 影のグラフィックを改善
- テキストのアンチエイリアスを有効にするオプションを追加(default: オン)。また、アンチエイリアスが有効なときのテキスト描写をより美しいものとするため同梱するフォントを東風ゴシックから源真ゴシックへ変更
- マナが足りない状態で詠唱しようとしたときの確認ウィンドウを省略するオプションを追加(デフォルト: オフ)
- 読み込もうとしているセーブデータが互換性のあるものかどうかを調べ、今動いている Elona foobar がそれを読み込めない場合エラーを報告するように
- 依存関係を用いて MOD を適切な順番で読み込むように
- ポートレイトシステムを改善。違う性別のポートレイトやNPC用のポートレイトを選べるようになった
- Windowsにおいて `Elona_foobar.exe` にアイコンを追加


### 変更

- 周りにペットがいない状態で鏡台を使ったとき方向を尋ねないように
- 矢弾を切り替えるメッセージの前で改行するように
- 冒険者の名前をニュースに表示するように
- 生もの装備を食べたときのメッセージの順番を変更


### 修正

- [本家] 「何かが地面に落ちた」のメッセージはアイテムが地面にある場合には表示しないように
- [本家] 見た目の変更メニューにおける PCC のアスペクト比を修正
- [本家] ダブルベッドと幸せのベッドのグラフィックが切れていたのを修正
- [本家] 選択キーの周りに表示されるゴミを削除
- [本家] 天候が変わった際、メッセージログウィンドウに現れる空白を削除
- [本家] 綴り鎧のアイテムチップが高すぎる場所にスタックするのを修正
- [本家] クミロミを信仰していると食べ物が腐らないことがあるのを修正
- [本家] エーテル病の進行度が上限を超えて進むことがあるのを修正
- [本家] 英語のテキストにおける省略記号をピリオド三つで置き換え。英語のフォントの中にはこの文字を持っていないものがあるため
- [本家] 死者の洞窟のグローバルマップにおける位置を一つ右に移動。以前の位置は崖の上であり、不正な位置であった。そのためそれぞれのセーブデータで異なる位置に配置される可能性があり、また稀に地殻変動のたびに死者の洞窟が動くようになっていた
- シナリオのシーン再生においてフェードアウトが機能していなかったのを修正
- スキルレベルが非常に高い(四桁)とスキルトラックの表示が被るのを修正
- 生産メニューにおけるアイテムの色が正しくないのを修正
- デフォルトのBGMが正しく読み込まれないのを修正
- 乱数生成器が各プラットフォームで同じ乱数を生成しないのを修正
- テキスト入力ボックスにおいて `Ctrl+V` (クリップボードから貼り付け) がリピートするのを修正
- macOS のテキスト入力ボックスにおいて IME が変換したテキストを見ることができないのを修正
- 仲間を選択する画面において仲間を正しく選択できないのを修正
- アイテムのグラフィックが別のものに置き換わることがあるのを修正
- 女性の盗賊団の頭領が黒塗りのポートレイトになるのを修正
- 虚空を這いずる者との会話が `Shift` や `ESC` でキャンセルできないのを修正
- タイポ修正



## [0.2.8] - 2018-09-15

### 追加

- シナリオシーンにおける文字の影を調整
- ログウィンドウに分を`[05]`のようにして0を埋めた状態で表示
- セーブデータの可搬性を向上。特にエンディアン
  - Elona foobarは常にデータをリトルエンディアンで保存します。ビッグエンディアンのマシンで動かした場合、foobarは読み込み時と保存時にデータを変換します


### 削除

- 古い本家のデータ(v1.22より前)へのサポートを削除
  - 将来的にはインポート・エクスポートができるようにする予定です
- 古いfoobarのデータ(v0.2.6かそれ以前)へのサポートを削除
  - v0.2.8(このバージョン)で読み込む前に、v0.2.7でデータをアップデートしてください


### 修正

- [本家] シェルターの上でシェルターを建設するとスタックするのを修正
- [本家] ウィンドウサイズが十分に大きいとき、小さいマップの左下の描写がおかしくなるのを修正
- 特殊弾のエンチャントが付与されないのを修正
- 生き武器が15のエンチャントを持っていて血を吸うとき、一番最後のエンチャントを破壊しないのを修正
- 祭壇の上に置いた水が祝福されないのを修正
- アイテムが火炎で燃やされた/冷気で破壊されたときクラッシュするのを修正
- キャラクターの口調が一つの会話の中で変化するのを修正(日本語モードのみ)
- ハウスボードから見られる"家の情報"ウィンドウにおいてキーヒントが抜けていたのを追加
- 最も価値の高いアイテムしか家宝に載っていなかったのを修正
- ポートレート中の黒のドット(`#000`)が透過していたのを修正
- 破壊アニメーションを再生する際、その場所が見えない場合は再生しないように
- セーブデータ選択画面において一度ページを変えるとウィンドウの影が消えるのを修正
- 取得できないフィートが取得できるのを修正。たとえば、交渉スキルを持っていなくとも交渉フィートを取ることができた
- タイポを修正



## [0.2.7] - 2018-09-05

### 追加

- ElonaFoobarからElona foobarに名称を変更
- LuaのAPIを多数追加。詳細はdocsフォルダを参照のこと
- 実験的にAndroidのサポートを追加
- セーブデータの読み込みを格段に高速化
- 本家の模様替え機能を実装
  - また、Ctrlキーと左クリックで塗りつぶしを実装
- ダメージポップアップ機能を拡張
  - ポップアップの数を変更するオプションを追加
  - バフが追加された/消えたときポップアップを表示
  - 属性ダメージと回復に色をつけて表示
- 設定メニューで各設定に説明を追加
- 原寸大PCC表示をサポート
- スキルトラック機能を拡張
  - 使えるスキルトラックの数を拡張(3->10)
  - スキルの潜在能力も一緒に表示
  - 高い潜在能力は緑で、低い潜在能力は赤で表示
- omake EN、omake overhaul EN、omake overhaul EN hackの翻訳を移植。これらを主に翻訳されたDoorknob氏に感謝申し上げます
- 設定ファイルをJSONからHCL形式に変更
  - ほとんどすべての設定がゲーム内から変えられるようになっています。おそらく直接触る必要はないでしょう
- 分針を左上の時計に追加


### 修正

- [本家] カジノでカードが配られているときの入力は保持しないように
- [本家] 金貨/プラチナがオーバーフローするのを修正
- [本家] 幸運を維持する装備を食べると落ちるのを修正
  - これを避けるため幸運の成長バフを新たに追加
- [本家] 収穫依頼の報酬がオーバーフローするのを修正
- [本家] Elonaのウィンドウサイズが800x600以外だったとき、レシピウィンドウのY座標がずれるのを修正
- プレイヤーダンジョンの名前が表示されないのを修正
- Enterキーのリピートがときどき速くなりすぎるのを修正
- テキストを多数修正
- カレントディレクトリが実行ファイルのディレクトリと異なるとき、Luaのrequire()が失敗するのを修正
- 売るとき、ログウィンドウに間違った金額が表示されるのを修正
- 左上の時計の下にゴミが表示されるのを修正
- 特定の場面で数値入力がループしないのを修正
- 日本語モードでハートマークが間違った場所に表示されるのを修正
- [w]earメニュー中の表示不具合を修正
- バブルのような分裂生物に関わるクラッシュを修正
- READMEのCONTRIBUTING.mdへのリンクを更新
- 呪われた食べ物が食べた後も消えないのを修正
- 火炎/冷気ダメージと耐火/耐冷ブランケットのおかしな挙動を修正
  - アイテム破壊がなくともブランケットが分かれるのを修正
  - 冷気ダメージについてのメッセージがPCが見えないところで起きたものに関しても表示されるのを修正
  - 耐火ブランケットの挙動がPCの視界に応じて変わるのを修正
- 特定条件下で斜めに歩けなくなるのを修正
- タイポを修正。主に英語
- ウィザードモードでも願いで異名が変えられるのを修正
- 犯罪者でなくとも願いでカルマが変動するのを修正



## [0.2.6] - 2018-06-19

### 追加

- 整数のオプションが不正な値になっていないか検証し、適正な範囲に制限するように
- テンキーの5が他のテンキーと同様に動くように
- 本家の"autonumlock"機能を実装 (Windowsのみ)
- omakeのような数値入力を実装
- Enter/BackSpaceキーのキー感度を調整
- omakeのような異名ロックを実装
  - `key_mode2`(デフォルトでは`*`)キーで異名をロックできる。ロックされた異名はリロールしても変わらない
- 選択した異名は異名ロール画面に戻って来たとき復元されるように
- キャラメイクの最終決定画面からポートレイトを選ぶ画面に戻れるように
- キャラメイクの際に最後の名前入力ボックスをキャンセルできるように
- 店売りの商品をスタックするように
- LuaのAPIを追加: `LuaCharacter.experience`


### 修正

- いくつかのエラーが表示されないのを修正
- README.mdとREADME-jp.mdを現在の状態に合うよう修正
- キャラクタレベル経験値のOFを修正
- 犯罪者のときダルフィで売買ができなくなるのを修正
- foobarに同梱されているフォントを使用している際のログウィンドウのグリッチを修正
- foobarのバージョン情報がセーブファイルに保存されていなかったのを修正
- 一時インベントリを開いた際に地面のアイテムが透明になるのを修正
  - 例えばブラックジャックや四次元ポケットなど
  - また、透明なアイテムがマップ再生成の際に複製されていたのを修正
- 上記のバグにより壊れたマップデータを修正
- foobarが日本語を含むフォルダに置かれていた場合にクラッシュするのを修正
  - この問題を避けるため、セーブデータの名前のつけ方を`sav_{プレイヤー名}`から`df04-0b4b-d0cc-a11b`のようなランダムに生成された名前に変更
- AIルーチンの無限ループを修正
- Autopickの"保存"マーク(`*`)が日本語のアイテム名の一部と鑑賞するのを修正
  - 保存マークは`*`から`%`に変更



## [0.2.5] - 2018-06-10

### 追加

- 実験的にLua APIを導入
- カジノでエーテル抗体をもらえる確率を引き上げ
  - omakeと同じ
- ダメージポップアップの処理速度改善
- キー入力の感度改善
- 影の描写を改善
- 画面サイズ、フルスクリーンのオプションを追加
- いくつかのNPCに専用ポートレイトを設定
- `animewait`の設定に基づいてアニメーションの長さを削減
- 生成数をデッキメニューに表示
- 入力画面で入力する文字数を制限
- ダメージポップアップの切り替えオプションを追加(`damage_popup`)
- PCの体重を計算する式を調整


### 削除

- すでに必要なくなった`original\config.txt`はコピーしないように
- マグルモードではミニマップに階段の位置を表示しないように


### 修正

- [本家] Elona不具合修正Wikiにある既知のバグを修正
  - 多すぎるのでまた後で
- [本家] 混沌三神が願いの杖を落とさなかったのを修正
- [本家] とある条件下でシナリオ進行中にPCが死ぬのを修正
- [本家] 神の下僕のようなペットのユニークNPCと会話できないのを修正
- [本家] 壁やドアで埋められたマップに入ると無限ループになるのを修正
- カジノのブラックジャックが辞められないのを修正
- シナリオをオンにしていても再生されないのを修正
- 日本語での名前を省略して表示するアルゴリズムを修正
- Shiftキーとテンキーで走れないのを修正
- テンキー側のEnterキーが効かないのを修正
- Enterキーが時々効かなくなるのを修正
- マグルモードで名声が願えてしまうのを修正
- 生き武器にエンチャントを付与できなかったのを修正
- ウィザードモードでアイテムやスキルが願えなかったのを修正
- boneファイルが日本語で文字化けするのを修正
- PCの名前をより厳格にチェックするように
- デッキを使ったときにクラッシュするのを修正
- キャラメイクの際PCC選択画面から一度戻ると、PCCの画面が飛ばされるのを修正
- 日本語のtypo修正



## [0.2.4] - 2018-05-20

### 修正

- セーブデータがGzip圧縮されていたのを修正
- フィートメニューにおいてフィート/変異/エーテル病に色がついていなかったのを修正



## [0.2.3] - 2018-05-19

### 追加

- ゲーム内からconfig.jsonのオプションの一部を変更できるように
  - Extra種族/職業
  - アニメウェイト/アラートウェイト
  - キーウェイト(初回)/キーウェイト
- 入荷頻度をオプションから変更できるように
  - 0-10まで(日単位。デフォルト3日)。0を選ぶと話しかけるたびに品揃えが変わる


### 修正

- 吟遊詩人の演奏でPCが経験値を得るのを修正
- BOM付きのUTF-8ファイルでも読み込めるよう修正
- ダメージポップアップが多すぎると極端に遅くなるのを修正
  - oomExと同様、同時に出現するポップアップの数に制限を設けた
- ダメージポップアップがマップを切り替えても残り続けるのを修正
- SEが鳴らないことがあるのを修正
- 時々BGMが頭から再生し直されるのを修正
- PC速度が遅くNPCが多いとスタックオーバーフローを起こすのを修正
- ファイル名/フォルダ名として不正な名前のPCを作ろうとすると落ちるのを修正
  - ファイル名/フォルダ名に使える名前に変換される
- 貴重なものでインベントリが埋まっている際にアイテム破壊が起こると無限ループが起こるのを修正
- アイテム破壊が起こると落ちることがあるのを修正
- タイポ修正(日本語)
- ジャーナルを開くと落ちることがあるのを修正
- ジャーナルにやたらと空行が混じっていたのを修正
- 数値入力がESC/Shiftキーでキャンセルできないのを修正
- ボール魔法やボルト魔法などで属性の色が反映されていなかったのを修正
- 能力値ロールにおいて、次へ進んでから戻ってくると残りロックが0になるのを修正
- 依頼掲示板でキーの効きが極端に悪くなるのを修正
- ゲーム内ヘルプが文字化けするのを修正
- PCの店で店主を任命する際、魅力と交渉の欄の表示がおかしくなるのを修正
- 採掘スキルが低いと壁が絶対に掘れないのを修正



## [0.2.2] - 2018-05-05

### 追加

- オートセーブを無効化するように
  - オプションメニューから再度有効にできます
- README.mdを現在の状況に合わせて更新
- 日本語版のREADMEであるREADME-jp.mdを追加


### 修正

- [本家] 洞窟を出ずに死ぬと洞窟から出られなくなるのを修正
- `key_close`のデフォルト値が`key_charainfo`と被る"c"になっていたのを修正
- 以下のクラッシュを修正:
  - 魔法使いの夢を見ると落ちる
  - 呪われていない/祝福された不思議な巻物を読むと落ちる
  - 冒険者から得意なスキルを聞くと落ちる
  - 冒険者からスキルの訓練を受けようとすると落ちる
  - 『リトルシスター』の死体を食べると落ちる
  - トレイナーに話しかけると落ちる
  - 能力獲得の巻物を読むと落ちる
  - 成長の巻物を読むと落ちる



## [0.2.1] - 2018-05-03

### 追加

- エラーログといくつかの情報をruntime/log.txtに出力するように


### 削除

- 本家のカスタムファイル形式への対応を削除
  - これは一時的な措置です。当然再度実装されます


### 修正

- [本家] 引っ越したときに雇用人が消えてしまうのを修正
- [本家] カジノの報酬を生成するのに失敗するとフリーズするのを修正
- 選択したテキストが黒く塗りつぶされているのを修正
- いくつかのライブラリがUnicodeバージョンになっていなかったのを修正
- いくつかのセーブデータが誤ったフォルダに保存されていたのを修正
- セーブフォルダの文字化けを修正
- ダウンロードされたフォルダに日本語が含まれると落ちるのを修正



## [0.2.0] - 2018-05-01

### 追加

- 魚のデータを外部化
  - テスト用に"謎のお魚"を追加
- 採掘モードを実装(oomEx互換)
- バージョニングを導入
- セーブデータにFoobarのバージョンを保存するように
- Wizardモードで祝呪状態を指定できるように
  - 祝福された/呪われていない/呪われた/堕落したをアイテム名の前に置いてください
- 願いの入力の際、[BackSpace]による削除と[Ctrl-V]による貼り付けが使えるように
- ペットのHPバーをomakeのように表示するように
- 紐で繋がれたペットのHPバーの横に紐のアイコンを表示するように
- 実行ファイルが置かれているフォルダを自動検知するように
- 願いの判定方法の向上
- フォントのスタイルをサポート(太字、イタリック体、下線)
- オプションのデフォルト値を定義するように
  - 長いconfig.jsonを用意する必要がなくなる
- ナンバーパッドを試験的にサポート
- ダメージポップアップを試験的に実装
- Autopickを試験的に実装
- デッキを使ったカード収集


### 削除

- 使用できないオプション(`cfg_msg_box`)を削除.
- テスト用のNPCを削除(低レベルにも関わらず強すぎるためテストプレイに支障をきたす)
- 一時的に高品質影描写を無効化
- Voldemortモードをデフォルトで無効化するように
  - [F12]を押すことでvoldemortモードに入ることができる


### 修正

- 体当たりでアインクから果実が落ちるのを修正
- スキルを願うと落ちるのを修正
- アイテムを解呪できないのを修正
- 能力値ロールでFoobarが終了するのを修正
- カジノの描写不具合を修正
- タブ文字が適切に描写されないのを修正
- 窃盗で落ちるのを修正
- 壁から長剣が掘れるのを修正
- シナリオシーンにおいて日本語テキストが中央ぞろえされていないのを修正
- ログウィンドウで日本語テキストの描写が崩れていたのを修正
- 選択カーソルが描写されていなかったのを修正
- ゲーム内からセーブデータが消せなかったのを修正
- タイポ修正(英語)



## [0.1.0] - 2018-04-08

### 追加

- Luaを導入
- データの一部をLuaスクリプトに外部化
- テキストの一部をLuaスクリプトに外部化
- 国際化
- 設定ファイルにJSONを使用
- カスタム種族
- カスタム職業
- カスタムNPC
- ウィザードモードで願うアイテムの個数を指定可能に
- 周りにドアが一つしかないとき閉じる方向を尋ねないように
- 自動採掘(autodig)
- 昇り階段/降り階段の位置をハイライト
- 常にHPバーを表示する
- Shiftキーを押しながらキャラクターと入れ替わる
- クイックセーブ&ロード
- NPCの行動の数の上限を撤廃(10 -> 無制限)
- キャラメイク時に最低値ロール


### 削除

- F12のコンソールコマンドを削除
- 古いバージョン(1.16よりも前)との互換性を放棄


### 修正

多すぎるのでまた後で
